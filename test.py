import gvec
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
import os
os.environ["OMP_NUM_THREADS"] = "1"

params = {}

params["ProjectName"] = "test_run"
params["PhiEdge"] = -276
params["which_hmap"] = 1
params["nfp"] = 1
params["X1_mn_max"] = [50, 1]
params["X2_mn_max"] = [50, 1]
params["LA_mn_max"] = [5, 1]
params["sgrid_nelems"] = 5
params["X1X2_deg"] = 3
params["LA_deg"] = 3
params["totalIter"] = 10000
params["minimize_tol"] = 1e-06
params["iota"] = {
    "type": "interpolation",
    "rho2": [0.0, 0.25, 0.5, 0.75, 1.0],
    "vals": [-0.8, -0.75625, -0.725, -0.70625, -0.7],
    "scale": 1,
}
params["pres"] = {
    "type": "interpolation",
    "rho2": [0.0, 0.25, 0.5, 0.75, 1.0],
    "vals": [0.8, 0.738125, 0.652500, 0.343125, 0.1],
    "scale": 1e6,
}

params["X1_b_cos"] = {
    (0, 0): 9.534005831598062,
    (1, 0): -2.3231117870446334,
    (2, 0): 0.0882389746336175,
    (3, 0): 0.11166824235439317,
    (4, 0): 0.017325121847984758,
    (5, 0): -0.016346140462846125,
    (6, 0): -0.007553253917910272,
    (7, 0): 0.0028124197243168604,
    (8, 0): 0.003030880016551841,
    (9, 0): 6.630975477701453e-05,
    (10, 0): -0.0008251091691492344,
    (11, 0): -0.00012219396271856759,
    (12, 0): 0.00033835934259382396,
    (13, 0): 0.00020832982746705846,
    (14, 0): -7.717524863228152e-06,
    (15, 0): -2.5107448539074537e-05,
    (16, 0): 4.143449046732952e-05,
    (17, 0): 5.9974579299394376e-05,
    (18, 0): 3.3240367427239154e-05,
    (19, 0): 1.5109543916914366e-05,
    (20, 0): 1.498598931235799e-05,
    (21, 0): 2.1782637448052953e-05,
    (22, 0): 1.613309660462236e-05,
    (23, 0): 1.5157347004572474e-05,
    (24, 0): 8.257722276156482e-06,
    (25, 0): 1.204072032919612e-05,
    (26, 0): 7.142590776239607e-06,
    (27, 0): 9.008835255898655e-06,
    (28, 0): 5.055185547537109e-06,
    (29, 0): 5.602205041510076e-06,
    (30, 0): 3.7735265812437703e-06,
    (31, 0): 3.7475296263186176e-06,
    (32, 0): 2.007795946362397e-06,
    (33, 0): 1.5917139179883205e-06,
    (34, 0): 4.10557755236895e-07,
    (35, 0): -2.1374662578098553e-07,
    (36, 0): -1.0396729056525913e-06,
    (37, 0): -1.3268911256073138e-06,
    (38, 0): -1.1344336775209742e-06,
    (39, 0): -1.7737129806355849e-06,
    (40, 0): -2.115779688536852e-06,
    (41, 0): -3.212250640379017e-06,
    (42, 0): -2.578502799867453e-06,
    (43, 0): -2.569139016971253e-06,
    (44, 0): -3.369196201225877e-06,
    (45, 0): -4.3291078980407874e-06,
    (46, 0): -4.537274847498458e-06,
    (47, 0): -3.816948839713811e-06,
    (48, 0): -3.87955039367458e-06,
    (49, 0): -5.248153561521313e-06,
    (0, 1): 0.4766884702169128,
    (1, 1): -0.11623184754548781,
    (2, 1): 0.004614265146854833,
    (3, 1): 0.0051406484164276825,
    (4, 1): 0.000795064244519629,
    (5, 1): -0.0007814881895896969,
    (6, 1): -0.0003484686784458247,
    (7, 1): 0.0001389113179960819,
    (8, 1): 0.00014532681725211807,
    (9, 1): 3.5376746280453636e-06,
    (10, 1): -3.8519722506204125e-05,
    (11, 1): -4.857162922858929e-06,
    (12, 1): 1.7036145594564807e-05,
    (13, 1): 1.0695297613829936e-05,
    (14, 1): 2.2781300830618688e-07,
    (15, 1): -6.581589638518368e-07,
    (16, 1): 2.4838660389853453e-06,
    (17, 1): 3.364977832989637e-06,
    (18, 1): 2.0358117959586395e-06,
    (19, 1): 1.1389433003883872e-06,
    (20, 1): 1.0864173657073418e-06,
    (21, 1): 1.4170604572427691e-06,
    (22, 1): 1.09654577199972e-06,
    (23, 1): 1.0709064939736605e-06,
    (24, 1): 6.750127378371406e-07,
    (25, 1): 8.929139961447904e-07,
    (26, 1): 5.946155583689156e-07,
    (27, 1): 7.18389170472359e-07,
    (28, 1): 4.803214154498236e-07,
    (29, 1): 5.188377309014856e-07,
    (30, 1): 4.1283577381347557e-07,
    (31, 1): 3.9959805256167536e-07,
    (32, 1): 3.14462165232723e-07,
    (33, 1): 2.798686127460458e-07,
    (34, 1): 2.1627419192333563e-07,
    (35, 1): 1.7950671990805601e-07,
    (36, 1): 1.2706954445948933e-07,
    (37, 1): 1.1491462932286973e-07,
    (38, 1): 1.125550981596671e-07,
    (39, 1): 8.345693672327428e-08,
    (40, 1): 5.769328886068e-08,
    (41, 1): -1.1980322885787436e-09,
    (42, 1): 2.8327172689862918e-08,
    (43, 1): 1.412491147671122e-08,
    (44, 1): -1.8109635540871463e-08,
    (45, 1): -7.20654755145676e-08,
    (46, 1): -8.428466956040009e-08,
    (47, 1): -5.782040032449075e-08,
    (48, 1): -6.603646290190719e-08, }
params["X1_b_sin"] = {
    (0, 0): 0.0,
    (1, 0): 0.0520755125047512,
    (2, 0): 0.004898967052940384,
    (3, 0): 0.0026304623617874026,
    (4, 0): -0.000929372303552746,
    (5, 0): 0.0010911491635737262,
    (6, 0): -0.0008729067909809218,
    (7, 0): -0.0007601412073078887,
    (8, 0): 9.941167664572659e-05,
    (9, 0): 0.0002798978905903632,
    (10, 0): -5.7762467216961294e-05,
    (11, 0): -0.00021381477333989098,
    (12, 0): -0.00010854913564541772,
    (13, 0): -8.288146562120489e-07,
    (14, 0): -1.1195743674378672e-05,
    (15, 0): -5.970081197406935e-05,
    (16, 0): -6.165772048994338e-05,
    (17, 0): -4.090129567573872e-05,
    (18, 0): -2.8334734384399877e-05,
    (19, 0): -3.3714561365717314e-05,
    (20, 0): -3.6243487646264554e-05,
    (21, 0): -3.4489142712968e-05,
    (22, 0): -2.9051954628973937e-05,
    (23, 0): -2.8828649660442212e-05,
    (24, 0): -2.7167175568156146e-05,
    (25, 0): -2.767297539252779e-05,
    (26, 0): -2.45441555563275e-05,
    (27, 0): -2.472955131805209e-05,
    (28, 0): -2.2804493262236446e-05,
    (29, 0): -2.2566587033422463e-05,
    (30, 0): -2.1809115080486662e-05,
    (31, 0): -2.0006753935065625e-05,
    (32, 0): -1.9789450441802916e-05,
    (33, 0): -1.8638316450721357e-05,
    (34, 0): -1.8174130457132858e-05,
    (35, 0): -1.8065839163491066e-05,
    (36, 0): -1.7361124108495123e-05,
    (37, 0): -1.7307117481873563e-05,
    (38, 0): -1.590582043096028e-05,
    (39, 0): -1.5161124240780498e-05,
    (40, 0): -1.4126992048204559e-05,
    (41, 0): -1.3977382003382015e-05,
    (42, 0): -1.4278571567618463e-05,
    (43, 0): -1.3109763189633165e-05,
    (44, 0): -1.2375284306926916e-05,
    (45, 0): -1.1774953360926295e-05,
    (46, 0): -1.2090746562442317e-05,
    (47, 0): -1.2053292565362402e-05,
    (48, 0): -1.114686531380471e-05,
    (49, 0): -1.0600901670592952e-05,
    (0, 1): -0.00021562236340040943,
    (1, 1): 0.002626471402733219,
    (2, 1): 0.000740088268932377,
    (3, 1): -0.000367732017392879,
    (4, 1): -0.00011743708541723364,
    (5, 1): 0.00012355266285447598,
    (6, 1): -1.4979032876350642e-05,
    (7, 1): -4.536542555576105e-05,
    (8, 1): -3.934476801098777e-06,
    (9, 1): 1.433234135284441e-05,
    (10, 1): 1.6379775337252578e-07,
    (11, 1): -9.690566614694556e-06,
    (12, 1): -5.95310561294208e-06,
    (13, 1): -2.9414194835235203e-07,
    (14, 1): -2.8388285516568526e-07,
    (15, 1): -2.6549765077202452e-06,
    (16, 1): -2.952405680331008e-06,
    (17, 1): -2.01613953079815e-06,
    (18, 1): -1.3461953932915693e-06,
    (19, 1): -1.5894475355250992e-06,
    (20, 1): -1.726268756189373e-06,
    (21, 1): -1.6639716174687552e-06,
    (22, 1): -1.4133168024175657e-06,
    (23, 1): -1.384716677983689e-06,
    (24, 1): -1.3323430448134619e-06,
    (25, 1): -1.3299489589145782e-06,
    (26, 1): -1.2201810408659466e-06,
    (27, 1): -1.1936194954555534e-06,
    (28, 1): -1.1365688351847476e-06,
    (29, 1): -1.0994629750664324e-06,
    (30, 1): -1.0898999334049552e-06,
    (31, 1): -9.817104458252258e-07,
    (32, 1): -9.93149442810417e-07,
    (33, 1): -9.240687015483516e-07,
    (34, 1): -9.136069668295925e-07,
    (35, 1): -9.065984666662156e-07,
    (36, 1): -8.7776057103639e-07,
    (37, 1): -8.80116018168234e-07,
    (38, 1): -8.108891191190089e-07,
    (39, 1): -7.823170348583563e-07,
    (40, 1): -7.221805419202622e-07,
    (41, 1): -7.221906984256065e-07,
    (42, 1): -7.282561168976468e-07,
    (43, 1): -6.787043874392919e-07,
    (44, 1): -6.463373214023255e-07,
    (45, 1): -6.123402823732249e-07,
    (46, 1): -6.293792969888487e-07,
    (47, 1): -6.282148300042565e-07,
    (48, 1): -5.903571107523931e-07,
    (49, 1): -5.677797990026528e-07, }
params["X2_b_cos"] = {
    (0, 0): 0.09724329412130757,
    (1, 0): -0.03755586700998666,
    (2, 0): 0.0035297062230153498,
    (3, 0): 0.004866182988792293,
    (4, 0): -0.0014151839262362238,
    (5, 0): -0.0024282364972237386,
    (6, 0): 0.001406326637916882,
    (7, 0): 0.0016246910240306535,
    (8, 0): 0.0003227719107427686,
    (9, 0): -6.421007358468209e-05,
    (10, 0): 0.0003586015688560077,
    (11, 0): 0.0006250951329899499,
    (12, 0): 0.0005216619557165851,
    (13, 0): 0.0003790050875024289,
    (14, 0): 0.00038617507292686897,
    (15, 0): 0.0004470690957990236,
    (16, 0): 0.00046123545314433304,
    (17, 0): 0.00043872262667711564,
    (18, 0): 0.00042597763878625015,
    (19, 0): 0.0004323550617653824,
    (20, 0): 0.00043941898789332873,
    (21, 0): 0.0004383315960036333,
    (22, 0): 0.0004348363901104859,
    (23, 0): 0.0004343828478988001,
    (24, 0): 0.0004358741121993485,
    (25, 0): 0.00043656430354703816,
    (26, 0): 0.00043583932065856566,
    (27, 0): 0.00043540573989090314,
    (28, 0): 0.0004348897149616237,
    (29, 0): 0.0004364841824355188,
    (30, 0): 0.0004350372301850763,
    (31, 0): 0.00043590637214673374,
    (32, 0): 0.0004362949787545595,
    (33, 0): 0.0004348808698532623,
    (34, 0): 0.00043525768054704513,
    (35, 0): 0.0004352344225714427,
    (36, 0): 0.00043512376421973035,
    (37, 0): 0.0004352330751268596,
    (38, 0): 0.0004360841715656698,
    (39, 0): 0.00043662176901352874,
    (40, 0): 0.00043524260578119416,
    (41, 0): 0.00043472599561814723,
    (42, 0): 0.0004344011782422074,
    (43, 0): 0.0004362370696354427,
    (44, 0): 0.00043709024565884353,
    (45, 0): 0.00043473011825424264,
    (46, 0): 0.00043346373122122146,
    (47, 0): 0.0004352134653439515,
    (48, 0): 0.000437327247884189,
    (49, 0): 0.0004355586243438631,
    (0, 1): 0.0048497130753580335,
    (1, 1): -0.0018628016619992138,
    (2, 1): 0.0001725994246755653,
    (3, 1): 0.000243551234959863,
    (4, 1): -7.05935829599079e-05,
    (5, 1): -0.00012125425111326281,
    (6, 1): 7.037081140310594e-05,
    (7, 1): 8.127602917701631e-05,
    (8, 1): 1.619271901791026e-05,
    (9, 1): -3.1527619219710796e-06,
    (10, 1): 1.7979390571396177e-05,
    (11, 1): 3.129976832375697e-05,
    (12, 1): 2.6124203557956575e-05,
    (13, 1): 1.8991684494832876e-05,
    (14, 1): 1.9346590099950628e-05,
    (15, 1): 2.2390882694563026e-05,
    (16, 1): 2.3095879226581126e-05,
    (17, 1): 2.197043047632656e-05,
    (18, 1): 2.133036398019007e-05,
    (19, 1): 2.1649512336132194e-05,
    (20, 1): 2.2000465093958347e-05,
    (21, 1): 2.194574277782445e-05,
    (22, 1): 2.1770030681770594e-05,
    (23, 1): 2.1745803730901514e-05,
    (24, 1): 2.18208899706359e-05,
    (25, 1): 2.18529901386798e-05,
    (26, 1): 2.1817961736241522e-05,
    (27, 1): 2.1793492862463135e-05,
    (28, 1): 2.1769137632450722e-05,
    (29, 1): 2.1846750690002545e-05,
    (30, 1): 2.1774371680954337e-05,
    (31, 1): 2.181735756782681e-05,
    (32, 1): 2.1836567592710133e-05,
    (33, 1): 2.1765002613874285e-05,
    (34, 1): 2.1783552940591576e-05,
    (35, 1): 2.178237080651697e-05,
    (36, 1): 2.1776171770403063e-05,
    (37, 1): 2.178044218750978e-05,
    (38, 1): 2.1823369952653304e-05,
    (39, 1): 2.1850426610846983e-05,
    (40, 1): 2.1781097341048457e-05,
    (41, 1): 2.1753868457635192e-05,
    (42, 1): 2.1736974855932158e-05,
    (43, 1): 2.1830002920700167e-05,
    (44, 1): 2.1872869504941236e-05,
    (45, 1): 2.175315874196393e-05,
    (46, 1): 2.168888167232725e-05,
    (47, 1): 2.1777087696187407e-05,
    (48, 1): 2.1883825510359804e-05,
    (49, 1): 2.1794267987527614e-05, }
params["X2_b_sin"] = {
    (0, 0): 3.423796334164751e-22,
    (1, 0): -3.0709115467539205,
    (2, 0): -0.022599417558335402,
    (3, 0): 0.14334144939434518,
    (4, 0): 0.040201136830258014,
    (5, 0): -0.01235484116642342,
    (6, 0): -0.006607468552979119,
    (7, 0): 0.006089081026787405,
    (8, 0): 0.007045686305797903,
    (9, 0): 0.003274440641127361,
    (10, 0): 0.0016752046794872542,
    (11, 0): 0.0021634453032640076,
    (12, 0): 0.0025677706488050948,
    (13, 0): 0.002293058807809521,
    (14, 0): 0.0018940276909267752,
    (15, 0): 0.0017308735371017255,
    (16, 0): 0.001694945439736617,
    (17, 0): 0.0016232870259107704,
    (18, 0): 0.0015076639933442127,
    (19, 0): 0.001404562177698035,
    (20, 0): 0.0013347415663488512,
    (21, 0): 0.0012732968653870308,
    (22, 0): 0.0012130299382961671,
    (23, 0): 0.0011512919546371948,
    (24, 0): 0.0010981609793807336,
    (25, 0): 0.0010507658633017844,
    (26, 0): 0.0010059509423908253,
    (27, 0): 0.0009649137471971944,
    (28, 0): 0.0009241092725234524,
    (29, 0): 0.0008890870305209738,
    (30, 0): 0.0008541565278808082,
    (31, 0): 0.0008217522626638921,
    (32, 0): 0.0007920415623642522,
    (33, 0): 0.0007639293722795209,
    (34, 0): 0.0007357360243214304,
    (35, 0): 0.0007102896970941947,
    (36, 0): 0.0006864447545373988,
    (37, 0): 0.0006623810021056804,
    (38, 0): 0.0006389276228288423,
    (39, 0): 0.0006194751570607525,
    (40, 0): 0.0006004543067358868,
    (41, 0): 0.0005798657171371883,
    (42, 0): 0.0005594899504487217,
    (43, 0): 0.0005422847493687344,
    (44, 0): 0.0005277716080889369,
    (45, 0): 0.0005113347181461536,
    (46, 0): 0.0004922543328777388,
    (47, 0): 0.00047627994267352553,
    (48, 0): 0.0004640451344832024,
    (49, 0): 0.0004516236438611393,
    (0, 1): 1.9126692029957617e-07,
    (1, 1): -0.15354318522241198,
    (2, 1): -0.001130523835972377,
    (3, 1): 0.007167170996254145,
    (4, 1): 0.002010113782625469,
    (5, 1): -0.0006176380598025793,
    (6, 1): -0.0003303172635293254,
    (7, 1): 0.0003044921231453843,
    (8, 1): 0.00035232085963576593,
    (9, 1): 0.0001637615588100806,
    (10, 1): 8.379424683175804e-05,
    (11, 1): 0.00010820233743973083,
    (12, 1): 0.00012841514036968755,
    (13, 1): 0.00011467818832790765,
    (14, 1): 9.472438241765948e-05,
    (15, 1): 8.65654398354063e-05,
    (16, 1): 8.476622534005748e-05,
    (17, 1): 8.118318695883906e-05,
    (18, 1): 7.539927257813347e-05,
    (19, 1): 7.024433908859943e-05,
    (20, 1): 6.675096078321496e-05,
    (21, 1): 6.367870323932724e-05,
    (22, 1): 6.066389594068969e-05,
    (23, 1): 5.757620044347013e-05,
    (24, 1): 5.491909821427455e-05,
    (25, 1): 5.254792198090155e-05,
    (26, 1): 5.030726119368933e-05,
    (27, 1): 4.8254239993035945e-05,
    (28, 1): 4.621334639236623e-05,
    (29, 1): 4.446223277104171e-05,
    (30, 1): 4.271460024353016e-05,
    (31, 1): 4.109350071994995e-05,
    (32, 1): 3.960825453901207e-05,
    (33, 1): 3.8201502218002085e-05,
    (34, 1): 3.6791571414680364e-05,
    (35, 1): 3.551918845567854e-05,
    (36, 1): 3.432686195012024e-05,
    (37, 1): 3.3122670070038923e-05,
    (38, 1): 3.194925315282666e-05,
    (39, 1): 3.097686953686893e-05,
    (40, 1): 3.0025416604629817e-05,
    (41, 1): 2.8996153901644844e-05,
    (42, 1): 2.7976131654079648e-05,
    (43, 1): 2.7115101447851188e-05,
    (44, 1): 2.6390245283911546e-05,
    (45, 1): 2.5568503232350434e-05,
    (46, 1): 2.4613482909278527e-05,
    (47, 1): 2.3813262000367145e-05,
    (48, 1): 2.320204747935431e-05,
    (49, 1): 2.2582300546074225e-05, }

params["init_average_axis"] = True
runpath = Path("test_run")

run = gvec.run(params, runpath=runpath, keep_intermediates="all")

state = run.state

rho = np.linspace(0, 1, 20)
theta = np.linspace(0, 2*np.pi, 50)
zeta = np.linspace(0, 2*np.pi, 25)

ev = state.evaluate("X1", "X2", "LA", "p", "iota", "pos",
                    rho=rho, theta=theta, zeta=zeta)

ev_axis = state.evaluate("pos", theta=[0.0], rho=[1e-8], zeta=zeta)
